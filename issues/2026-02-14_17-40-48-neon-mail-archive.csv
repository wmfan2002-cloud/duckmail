"id","priority","phase","area","title","description","acceptance_criteria","test_mcp","review_initial_requirements","review_regression_requirements","dev_state","review_initial_state","review_regression_state","git_state","owner","refs","notes"
"NMA-000","P0","0.1","backend","接入 Neon 与迁移基建","新增 Drizzle 与 Neon 连接和 migration 脚手架，建立可重复执行的 schema 变更流程。","在本地与预发各执行 1 次 migration 后，mailboxes/messages/sync_runs/sync_events 表与核心索引均存在，并完成一次插入+查询 smoke 验证。","AUTOSERVER","连接层使用 serverless 友好驱动与连接池；迁移脚本幂等且失败可回滚；不破坏现有 Next.js 构建流程。","连续执行 migrate+rollback+migrate 三轮无脏状态；首页与关键路由构建通过且无新增构建错误。","已完成","已完成","已完成","已提交","","plan/2026-02-14_17-34-08-neon-mail-archive.md:219;plan/2026-02-14_17-34-08-neon-mail-archive.md:220;plan/2026-02-14_17-34-08-neon-mail-archive.md:221;package.json:14;db/schema.ts:13;lib/archive/db.ts:25;lib/archive/migration-runner.ts:91;scripts/db/migrate.ts:4;scripts/db/rollback.ts:16;scripts/db/smoke.ts:5;db/migrations/0000_initial.up.sql:1;README.md:71;package.json:13","picked_reason:P0 基建先行，后续 issue 依赖迁移与数据层。 | validation_limited:缺少 DATABASE_URL，无法在当前环境执行真实 migrate/rollback/smoke。 | manual_test:export DATABASE_URL=<neon_url> && pnpm db:migrate && pnpm db:smoke && pnpm db:rollback -- --steps=1 && pnpm db:migrate | evidence:pnpm db:migrate -- --plan 输出 0000_initial；pnpm exec tsc --noEmit 通过；pnpm build 通过；pnpm db:migrate 在无 DATABASE_URL 下按预期失败。 | risk:medium 未验证真实 Neon 连接与事务回滚链路。 | done_at:2026-02-14T17:50:26Z | blocked:git commit failed Author identity unknown，需要配置 git user.name/user.email。 | blocked_resolved:已配置 git user.name/user.email，重新执行提交。"
"NMA-010","P0","0.2","backend","加密与归档配置安全基线","实现邮箱凭据 AES-256-GCM 加密存储与环境变量校验，禁止明文凭据入库。","未配置 ARCHIVE_MASTER_KEY 或长度小于 32 字节时服务启动失败；mailboxes 写入后 password_enc 非明文并可通过受控解密校验。","AUTOSERVER","密钥只允许来自环境变量；日志与错误信息不得输出密码 token 正文；加解密 API 只暴露最小必要接口。","执行新增/更新/读取凭据全流程测试并检查日志脱敏；错误密钥场景返回可观测错误且不泄露敏感信息。","已完成","已完成","已完成","已提交","","plan/2026-02-14_17-34-08-neon-mail-archive.md:222;plan/2026-02-14_17-34-08-neon-mail-archive.md:192;plan/2026-02-14_17-34-08-neon-mail-archive.md:193;plan/2026-02-14_17-34-08-neon-mail-archive.md:195;lib/archive/crypto.ts:22;lib/archive/mailbox-repository.ts:22;app/api/archive/mailboxes/route.ts:21;scripts/archive/check-config.ts:3;scripts/archive/crypto-self-test.ts:3;README.md:91;package.json:16","picked_reason:P0 安全基线优先，后续导入与同步必须依赖密文存储。 | validation_limited:当前环境无可用 DATABASE_URL，未执行真实 mailboxes 写库与解密 API 端到端验证。 | manual_test:ARCHIVE_MASTER_KEY=<32+> DATABASE_URL=<neon_url> ARCHIVE_DEBUG_TOKEN=<token> 启动服务后执行 POST /api/archive/mailboxes 写入，再以 GET /api/archive/mailboxes?email=<x>&revealCredential=1 + x-archive-debug-token 验证受控解密。 | evidence:ARCHIVE_MASTER_KEY 缺失与短密钥场景均返回失败；pnpm archive:check-config 在合法配置下通过；pnpm archive:crypto-self-test 通过且密文不等于明文；pnpm exec tsc --noEmit 与 pnpm build 通过。 | risk:medium 尚未在真实 Neon 实例验证 password_enc 入库与受控解密链路。 | done_at:2026-02-14T17:57:35Z"
"NMA-020","P1","1.1","backend","邮箱账号管理 API 与批量导入","实现单个添加、批量导入、列表、启停与 test-login API，并输出逐行导入结果。","导入 500 行有效邮箱时成功率 >= 99%，失败行返回行号和原因；test-login 对无效凭据返回可识别错误码。","AUTOSERVER","入参校验覆盖 CSV 与文本两种格式；接口响应字段保持稳定；导入过程限流避免触发上游抖动。","执行 500 行导入回归与重复导入幂等检查；无效格式不会写库；关键 API 错误率 < 1%。","已完成","已完成","已完成","已提交","","plan/2026-02-14_17-34-08-neon-mail-archive.md:227;plan/2026-02-14_17-34-08-neon-mail-archive.md:228;plan/2026-02-14_17-34-08-neon-mail-archive.md:232;plan/2026-02-14_17-34-08-neon-mail-archive.md:266;plan/2026-02-14_17-34-08-neon-mail-archive.md:135;app/api/archive/mailboxes/route.ts:21;app/api/archive/mailboxes/import/route.ts:18;app/api/archive/mailboxes/test-login/route.ts:15;app/api/archive/mailboxes/[id]/route.ts:11;lib/archive/mailbox-import.ts:151;lib/archive/provider-client.ts:29;lib/archive/mailbox-repository.ts:73;scripts/archive/import-parser-self-test.ts:11;scripts/archive/test-login-self-test.ts:3;README.md:104;package.json:18","picked_reason:先完成后端邮箱管理 API，供 NMA-030 前端管理页直接复用。 | validation_limited:未连接真实 DATABASE_URL 与上游 mail.tm，未执行真实 500 行入库与远端 test-login 回归。 | manual_test:ARCHIVE_MASTER_KEY=<32+> DATABASE_URL=<neon_url> pnpm dev 后调用 POST /api/archive/mailboxes/import(500行)；PATCH /api/archive/mailboxes/:id 切换启停；POST /api/archive/mailboxes/test-login 校验 INVALID_CREDENTIALS 错误码。 | evidence:pnpm archive:import-parser-self-test 验证 500 行解析与逐行失败定位；pnpm archive:test-login-self-test 验证错误码稳定；pnpm exec tsc --noEmit 与 pnpm build 通过。 | risk:medium 真实数据库写入吞吐与远端登录限流尚未在生产等价环境验证。 | done_at:2026-02-14T18:02:43Z"
"NMA-030","P1","1.2","frontend","邮箱管理页与导入交互","实现邮箱管理前端页面，包含表格、导入弹窗、错误回显与启停操作入口。","导入结果可展示 success/failed/reason 明细；500 行导入后页面在 2 秒内完成结果渲染并支持错误行筛选。","AUTOFRONTEND","表单校验与后端错误码映射一致；长列表渲染不阻塞主线程；交互文案明确且无歧义。","执行 500 行导入与分页浏览回归；主流桌面分辨率无布局溢出；关键操作可重复执行且状态一致。","未开始","未开始","未开始","未提交","","plan/2026-02-14_17-34-08-neon-mail-archive.md:229;plan/2026-02-14_17-34-08-neon-mail-archive.md:232;plan/2026-02-14_17-34-08-neon-mail-archive.md:209",""
"NMA-040","P0","2.1","backend","同步 Worker 核心流程与幂等入库","实现 token/messages/detail 拉取链路、消息 upsert 去重和失败退避。","手动触发同步可完成列表+详情抓取并写库；重复运行同批次消息无重复记录，去重准确率保持 100%。","AUTOSERVER","全局 QPS 限制 <= 6 且批次并发 3~4 可配置；失败退避策略可追踪；单邮箱失败不阻断其他邮箱。","执行 24 小时小流量连续同步回归无致命中断；失败重试后结果最终一致；sync_events 记录完整。","未开始","未开始","未开始","未提交","","plan/2026-02-14_17-34-08-neon-mail-archive.md:235;plan/2026-02-14_17-34-08-neon-mail-archive.md:237;plan/2026-02-14_17-34-08-neon-mail-archive.md:240;plan/2026-02-14_17-34-08-neon-mail-archive.md:182;README.md:90",""
"NMA-050","P1","2.2","backend","Scheduled 与 Background 调度链路打通","实现 dispatch 与 background worker 协作，按 due 邮箱触发同步并记录 run 状态。","Scheduled 每 10 分钟触发 dispatch；单次 dispatch 控制在 30 秒内；重任务由 background 完成且 sync_runs 状态可查询。","AUTOE2E","避免全量重写规则影响 API 路由；定时触发与手动触发复用同一服务；超时与重入行为有保护策略。","验证 schedule->dispatch->worker 三次连续成功；故障注入下 run 状态和错误日志完整；无重复触发风暴。","未开始","未开始","未开始","未提交","","plan/2026-02-14_17-34-08-neon-mail-archive.md:236;plan/2026-02-14_17-34-08-neon-mail-archive.md:177;plan/2026-02-14_17-34-08-neon-mail-archive.md:178;plan/2026-02-14_17-34-08-neon-mail-archive.md:179;netlify.toml:8",""
"NMA-060","P1","3.1","backend","消息检索详情与删除策略 API","实现消息列表筛选、正文详情与 local/remote/both 删除模式 API。","支持 mailbox/domain/from/subject/q/start/end 组合筛选；mode=local|remote|both 三种删除返回一致状态并可审计。","AUTOSERVER","查询参数与索引策略匹配避免全表扫描；删除流程幂等并定义远端失败降级；审计日志记录删除来源。","回归关键词检索、时间范围、多条件组合和三种删除模式；远端删除失败重试不造成本地状态错乱。","未开始","未开始","未开始","未提交","","plan/2026-02-14_17-34-08-neon-mail-archive.md:243;plan/2026-02-14_17-34-08-neon-mail-archive.md:244;plan/2026-02-14_17-34-08-neon-mail-archive.md:248;plan/2026-02-14_17-34-08-neon-mail-archive.md:153;plan/2026-02-14_17-34-08-neon-mail-archive.md:159",""
"NMA-070","P1","3.2","frontend","归档检索页与同步日志可视化","实现归档查询界面、正文详情展示、删除反馈及同步记录与错误日志展示。","可按关键词检索正文并查看详情；执行删除后页面状态 5 秒内刷新；最近同步记录与失败原因可查看。","AUTOE2E","列表分页与详情加载采用渐进式请求；错误提示与后台错误码一致；危险操作提供二次确认。","执行 导入->同步->检索->删除 端到端回归通过；网络抖动场景下页面状态一致且可恢复。","未开始","未开始","未开始","未提交","","plan/2026-02-14_17-34-08-neon-mail-archive.md:245;plan/2026-02-14_17-34-08-neon-mail-archive.md:248;plan/2026-02-14_17-34-08-neon-mail-archive.md:263;plan/2026-02-14_17-34-08-neon-mail-archive.md:169",""
"NMA-080","P2","4","both","稳定性增强：FTS/TTL/指标告警","实现全文检索索引优化、TTL 保留策略任务与失败率/延迟指标可观测。","FTS 启用后 10 万样本关键词检索 p95 < 1.5s；TTL 每日任务成功执行并记录删除统计；失败率和延迟指标可查询。","AUTOE2E","性能优化不改变检索语义；TTL 保留窗口可配置且可停用；指标口径与统计周期写入文档。","对比优化前后查询延迟与资源占用；模拟失败任务可触发告警；连续 7 天监控无数据缺口。","未开始","未开始","未开始","未提交","","plan/2026-02-14_17-34-08-neon-mail-archive.md:250;plan/2026-02-14_17-34-08-neon-mail-archive.md:251;plan/2026-02-14_17-34-08-neon-mail-archive.md:252;plan/2026-02-14_17-34-08-neon-mail-archive.md:253;plan/2026-02-14_17-34-08-neon-mail-archive.md:256",""
